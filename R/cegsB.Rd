\name{cegsB}
\alias{cegsB}
\title{
The compound exponential-geometric series fit by a Bayesian calculation
}
\description{
Uses a Bayesian calculation to fit a species abundance distribution to the compound exponential-geometric series.
}
\usage{
cegsB(n)
}
\arguments{
  \item{n}{
A vector of integer counts representing the number of individuals per species.
}
}
\details{
This function fits the compound exponential-geometric series (CEGS) distribution, returning the corrected Akaike information criterion (AICc) fit statistic and the rank and species abundance distributions in addition to estimated richness and the distribution's two governing parameters.

CEGS assumes each count is generated by a random draw from the geometric series (GS), but with the governing parameter \emph{p} of the GS being itself a function of a random exponential variate \emph{E} = -log(\emph{U}), where \emph{U} is uniformly distributed between 0 and 1. In other words, each count is doubly random. The expression is fitted to data by varying a scale term \eqn{\lambda} and a shape term \eqn{\gamma}, which feature in the probability mass function at different points.

Further details that include the derivation of the compound distribution are given on the \link{cegsML} manual page.

The calculations assume that the prior is an odds distribution. Likelihoods are sampled in the parameter space accordingly, with 50 points arrayed along each dimension.
The quantiles \emph{q} are 1:50/51 and the odds are \emph{q} divided by 1 - \emph{q}, so the limits are 1/50 and 50 both for \eqn{\lambda} and for \eqn{\gamma}.

Three matrices are needed to compute the posteriors: the first tracks \eqn{\lambda} and has repeated quantile values along rows; the second tracks \eqn{\gamma} and is simply a transpose of the first; and the third includes likelihoods corresponding to all combinations of the parameters.

The matrix of likelihoods is scaled so it sums to 1; it is multiplied across the \eqn{\lambda} quantile matrix; the sum is taken to yield a posterior quantile estimate; and finally, odds are computed based on the sum to obtain the posterior estimate of \eqn{\lambda}. \eqn{\gamma} is calculated in the same way, except that the quantile matrix for this parameter is used. 

An AICc is also reported for comparability with other functions. \link{cegsML} will produce lower AICcs if a likelihood approach is preferred. The likelihood calculation that yields the AICc is explained in the package details.

Like \link{cegsLD}, \emph{cegsB} produces species richness estimates with low variance because it takes all likelihoods into account. However, \link{cegsLD} does not assume a prior distribution. \link{cegsML} is faster than either one.

The function \link{rcegs} computes random integers based on the distribution.
}
\value{
  \item{richness}{The sample's estimated species richness.}
  \item{scale}{The estimated \eqn{\lambda} (scale) parameter of the CEGS distribution.}
  \item{shape}{The estimated \eqn{\gamma} (shape) parameter of the CEGS distribution.}
  \item{AICc}{The corrected Akaike information criterion value computed from the log likelihood.}
  \item{fitted.RAD}{The predicted rank abundance distribution.}
  \item{fitted.SAD}{The predicted species abundance distribution.}
}
\author{
John Alroy
}
\examples{
# CEGS distribution
n <- rcegs(100)
cegsB(n[n > 0])$richness

# Poisson log normal distribution
n <- rpois(100,exp(rnorm(100,sd=2)))
cegsB(n[n > 0])$richness

# scaled odds distribution
n <- rodds(100,1)
cegsB(n[n > 0])$richness
}
